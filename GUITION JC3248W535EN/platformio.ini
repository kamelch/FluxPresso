[platformio]
; PlatformIO versions differ; `test_default_envs` is not universally supported.
; Setting `default_envs` makes `pio test` run ONLY the native host tests by default.
; Firmware is built with: `pio run -e esp32-s3-devkitc-1`
;default_envs = native

[env:esp32-s3-devkitc-1]
platform = espressif32@6.4.0
board = esp32-s3-devkitc-1
framework = arduino

; Unit tests are executed on the host (native) only.
; Use: pio test -e native
test_ignore = *

board_build.partitions = partitions_16MB.csv
board_build.flash_mode = qio
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L

monitor_speed = 115200
monitor_filters = esp32_exception_decoder

build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DLV_CONF_INCLUDE_SIMPLE
    -DLV_LVGL_H_INCLUDE_SIMPLE
    -I src

lib_deps = 
    lvgl/lvgl@^8.3.11
    adafruit/Adafruit MAX31855 library@^1.4.0
    bogde/HX711@^0.7.5
    bblanchon/ArduinoJson@^6.21.3
    moononournation/GFX Library for Arduino@1.4.7
    tamctec/TAMC_GT911@^1.0.2

upload_speed = 921600

; -------------------- Unit test environment --------------------
; Run with: pio test -e native
[env:native]
platform = native
test_framework = unity

; Some setups inject a non-standard flag like -std=c++15 (doesn't exist).
; Remove any injected -std=... then set a known-good standard.
build_unflags =
    -std=c++15
    -std=gnu++17
    -std=c++17
    -std=gnu++14
    -std=c++14
    -std=gnu++11
    -std=c++11

build_flags =
    -DUNIT_TEST
    ; Windows toolchains bundled with some setups don't support gnu++17; gnu++11 is enough for our tests.
    -std=c++11
; Compile ONLY testable, hardware-independent logic (no Arduino/LVGL/Preferences)
build_src_filter =
    -<*>
    +<logic/*>
    +<controllers/*>
    +<utils/*>
